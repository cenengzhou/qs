variables:
  M2_HOME: /opt/apache-maven-3.6.3
  CACHE_VER: 1
steps:
- task: JavaToolInstaller@0
  inputs:
    versionSpec: '8'
    jdkArchitectureOption: 'x64'
    jdkSourceOption: 'PreInstalled'    
- task: Cache@2
  inputs:
    key: '"v$(CACHE_VER)" | "global" | "$(Agent.OS)"'
    path: /home/vsts/.m2
    cacheHitVar: 'm2CacheHit'
  displayName: CacheM2
- bash: |
    wget https://mirrors.estointernet.in/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz
    tar -xvf apache-maven-3.6.3-bin.tar.gz
    mv apache-maven-3.6.3 /opt/
    M2_HOME=$(M2_HOME)
    PATH="$M2_HOME/bin:$PATH"
    export PATH
    which java
    echo $JAVA_HOME
    ls -al $(M2_HOME)
    sed -i "s|<artifactId>pcms</artifactId><version>.*</version>|<artifactId>pcms</artifactId><version>$(Build.BuildNumber)</version>|" pom.xml && cat pom.xml | grep \<version\> | head -n1
    # sed -i "s|<jdk1.8>.*</jdk1.8>|<jdk1.8>/usr/lib/jvm/java-8-openjdk-amd64</jdk1.8>|" pom.xml && cat pom.xml | grep \<jdk1.8\> | head -n1
    # sed -i "s|<executable>.*</executable>|<executable>/usr/lib/jvm/java-8-openjdk-amd64/bin/java</executable>|" pom.xml && cat pom.xml | grep \<executable\> | head -n1
    mvn -version
    /usr/lib/jvm/temurin-8-jdk-amd64/bin/java -version
    mvn package
    # ls -alR ~/.m2
- task: PublishBuildArtifacts@1
  displayName: 'Publish to artifacts'
  inputs:
    PathtoPublish: './target/ROOT.war'
    ArtifactName: 'target'
    publishLocation: 'Container'
